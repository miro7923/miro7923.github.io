---
title: ì—ëŸ¬í•´ê²° Log) JAVA JSP Servlet ê¸€ ë‚´ìš© ìˆ˜ì •í•  ë•Œ ì²¨ë¶€íŒŒì¼ì´ ì‚¬ë¼ì§€ëŠ” ë¬¸ì œ
toc: true
toc_sticky: true
toc_label: ëª©ì°¨
published: true
categories:
    - ErrorLog
tags:
    - Error
    - Solve
    - Log
---
# ì‚¬ìš©í™˜ê²½
* MacBook Air (M1, 2020) 16GB
* JDK 8
* Eclipse 2021-12
* tomcat 8.5<br><br><br>

# ì—ëŸ¬ì˜ ë°œìƒ
* ìš”ì¦˜ `JAVA`ì™€ `JSP`, `Servlet`ìœ¼ë¡œ ê²Œì‹œíŒì„ ë§Œë“¤ë˜ ì¤‘ íŒŒì¼ ì—…ë¡œë“œ ê¸°ëŠ¥ì„ ì¶”ê°€í–ˆë‹¤. ê·¸ëŸ°ë° ê²Œì‹œê¸€ì„ ìˆ˜ì •í•˜ë©´ ë“±ë¡ë˜ ìˆë˜ ì´ë¯¸ì§€ì™€ ì²¨ë¶€íŒŒì¼ì´ ì‚­ì œë˜ëŠ” ê²ƒì´ì—ˆë‹¤. ğŸ¥² `DB`ì— ë“±ë¡ë˜ ìˆë˜ íŒŒì¼ëª… ìì²´ê°€ `null`ì´ ë˜ì–´ë²„ë¦¼...
* êµ¬ê¸€ ê²€ìƒ‰ì„ ì‹œë„í•´ë³´ë‹ˆ ì—…ë¡œë“œ í•œ íŒŒì¼ì˜ ìˆ˜ì •ì´ í•„ìš”í•  ë• ì—…ë¡œë“œ í–ˆë˜ íŒŒì¼ì„ ì‚­ì œí•˜ê³  ë‹¤ì‹œ ì²¨ë¶€í•´ì•¼ í•œë‹¤ëŠ” ë‚´ìš©ì´ ë§ì•„ì„œ ê·¸ë ‡ê²Œ í•´ ë³´ì•˜ëŠ”ë° ì—¬ì „íˆ ë¬¸ì œ í•´ê²°ì—ëŠ” ë„ì›€ì´ ë˜ì§€ ì•Šì•˜ë‹¤.
* ê·¸ë˜ì„œ ì¢€ ë” ìƒê°í•´ ë³´ë‹ˆ ì—…ë¡œë“œ ëœ íŒŒì¼ì„ ì‚­ì œí•˜ëŠ” ì½”ë“œë¥¼ ì“´ ì  ì—†ì—ˆê¸° ë•Œë¬¸ì— ì—…ë¡œë“œ ë˜ëŠ” íŒŒì¼ë“¤ì´ ì €ì¥ë˜ëŠ” ê²½ë¡œì— ê°€ì„œ í™•ì¸í•´ ë³´ë‹ˆ ì—­ì‹œ íŒŒì¼ë“¤ì€ ê·¸ëŒ€ë¡œ ìˆì—ˆë‹¤. ë‚´ê°€ ì§  ë¡œì§ì€ `DB`ì—ëŠ” ì—…ë¡œë“œ í•œ íŒŒì¼ëª…ë§Œ ì €ì¥í•˜ê³  ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¬ ë•Œ ì„œë²„ì— ì—…ë¡œë“œ ë˜ëŠ” ê²½ë¡œë¡œ ì°¾ì•„ê°€ì„œ í•´ë‹¹ íŒŒì¼ë“¤ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ê²ƒì´ë¼ì„œ `DB`ì—ì„œ ì—…ë°ì´íŠ¸ ë  ë•Œ íŒŒì¼ëª…ë§Œ ì˜ ë³´ì¡´í•´ ì£¼ë©´ ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆëŠ” ê²ƒì´ì—ˆë‹¤.
* ê²Œì‹œê¸€ ì‘ì„± ë° ìˆ˜ì •ì‹œ í¼íƒœê·¸ì˜ `enctype="multipart/form-data"` ì†ì„±ì„ ì‚¬ìš©í•´ì„œ ì „ì†¡ í•˜ê¸° ë•Œë¬¸ì— íŒŒë¼ë¯¸í„°ë¥¼ ë°›ì„ ë•Œ `Multipart` ê°ì²´ë¥¼ ì‚¬ìš©í•´ì„œ ë°›ì•„ì•¼ í•˜ëŠ”ë° ì´ ê³¼ì •ì—ì„œ ì‹¤ì œë¡œ ë°›ì€ íŒŒì¼ì´ ì—†ë‹¤ë³´ë‹ˆ íŒŒì¼ëª…ì„ ì¶”ì¶œí•˜ëŠ” ê³¼ì •ì´ ìƒëµë˜ì—ˆê³ , `DB` ì—…ë¡œë“œìš© `DTO` ê°ì²´ë¥¼ ìƒì„±í•˜ëŠ” ê³¼ì •ì—ì„œ íŒŒì¼ëª…ì— ëŒ€í•œ ì •ë³´ê°€ ëˆ„ë½ëœ ê²ƒì´ì—ˆë‹¤...!! ê·¸ë¦¬ê³  `DB` ì ‘ì†í•´ì„œ ì—…ë°ì´íŠ¸ ë™ì‘ì„ ìˆ˜í–‰í•˜ëŠ” ê³¼ì •ì—ì„œ `null`ì´ ì…ë ¥ë˜ê²Œ ëœë‹¤...
* ê·¸ëŸ¬ë©´ `file` íƒ€ì… `input` íƒœê·¸ì˜ `value` ê°’ì„ ê¸°ì¡´ì— ì €ì¥ë˜ì–´ ìˆë˜ íŒŒì¼ëª…ìœ¼ë¡œ ë„£ì–´ë†“ìœ¼ë©´ ë˜ì§€ ì•Šë‚˜ ì‹¶ì—ˆë‹¤. ê·¸ëŸ°ë° ì•ˆ ë¨
* êµ¬ê¸€ë§ í•´ ë³´ë‹ˆ `file` íƒ€ì…ì€ `readonly`ë¼ì„œ íŒŒì¼ì„ ì§ì ‘ ë“±ë¡í•  ë•Œê°€ ì•„ë‹ˆë©´ ì„ì˜ë¡œ `value`ê°’ì„ ë„£ì–´ì¤„ ìˆ˜ ì—†ë‹¤ê³  í•œë‹¤. `value` ìˆ˜ì •ì´ ê°€ëŠ¥í•œ ê²½ìš°ëŠ” `value`ê°’ì´ ìˆì„ ë•Œ ê·¸ ê°’ì„ ì§€ìš¸ ë•Œ ë¿ì´ì—ˆìŒ. ê·¸ë˜ì„œ ë‹¤ë¥¸ ë°©ë²•ì„ ì°¾ì•„ì•¼ í–ˆë‹¤.<br><br>

# ë¬¸ì œ í•´ê²°

## boardModify.jsp

```jsp
<%
    String imgPath = request.getServletContext().getRealPath("/images") + File.separator + "origins" + File.separator + dto.getImage();
    System.out.println("imgPath: "+imgPath);
%>
<form name="write" action="./BoardModifyPro.bo" method="post" enctype="multipart/form-data" onsubmit="return finalCheck();">
  <div class="formRow">
    <label for="MOD_TEXTFORM_NameField">ì´ë¯¸ì§€ ë“±ë¡ </label><input type="file" name="image" id="image" oninput="formatCheck();">
    <input type="hidden" name="oldImgPath" value="<%=imgPath%>">
    <input type="hidden" name="oldImgName" value="<%=dto.getImage()%>">
    <input type="hidden" name="imgUploadStatus" value="true">
  </div>
<div>ë“±ë¡ëœ ì´ë¯¸ì§€ : <span id="imgName"> <%=dto.getImage() %> </span>&nbsp; <a href="javascript:void(0);" onclick="removeImg();">ì‚­ì œ</a></div><br>
</form>
```

* ê¸€ ìˆ˜ì • í˜ì´ì§€ì˜ í¼íƒœê·¸ ì•ˆì—ì„œ `hidden` íƒ€ì… `input` íƒœê·¸ë¥¼ ì¨ì„œ ê¸°ì¡´ì— ì €ì¥ë˜ì–´ ìˆë˜ íŒŒì¼ëª…ì„ ì €ì¥í•´ ë‘ì—ˆë‹¤ í•¨ê»˜ ì „ì†¡í–ˆë‹¤.
* ë§Œì•½ ì‚­ì œ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ `onclick` ì´ë²¤íŠ¸ë¥¼ í†µí•´ `imgUploadStatus`ë¥¼ `false`ë¡œ ë°”ê¿” ê¸°ì¡´ì— ë“±ë¡í–ˆë˜ íŒŒì¼ì„ ì‚­ì œí•  ê²ƒì„ì„ ì•Œë¦°ë‹¤.

## BoardModifyProAction.java

```java
public class BoardModifyProAction implements Action 
{
    @Override
    public ActionForward execute(HttpServletRequest request, HttpServletResponse response) throws Exception 
    {
        System.out.println("M : BoardModifyProAction - execute() í˜¸ì¶œ");
		
        // í•œê¸€ì²˜ë¦¬
        request.setCharacterEncoding("UTF-8");
		
        // DBì—ì„œ ê¸°ì¡´ ê¸€ ì •ë³´ë¥¼ ì°¾ì€ ë‹¤ìŒ ìƒˆ ë‚´ìš©ìœ¼ë¡œ ìˆ˜ì •
        FileUpload fu = new FileUpload();
        BoardDTO dto = fu.upload(request);
  
        // .. í•˜ëµ
    }
}
```

* ê¸€ ìˆ˜ì • ë™ì‘ì„ ìˆ˜í–‰í•˜ëŠ” ì„œë¸”ë¦¿ìœ¼ë¡œ ì˜¤ë©´ íŒŒì¼ ì—…ë¡œë“œ ì²˜ë¦¬ë¥¼ ìœ„í•œ í´ë˜ìŠ¤ì¸ `FileUpload`ë¡œ ì´ë™í•œë‹¤.

## FileUpload.java

```java
BoardDTO dto = new BoardDTO();

// ê¸°ì¡´ì— ì €ì¥ë˜ ìˆë˜ íŒŒì¼ ì •ë³´ë¥¼ ì €ì¥í•  ë³€ìˆ˜
String imgUploadStatus = null;
String oldImgPath = null;
String oldImgName = null;

...


else if (name.equals("oldImgName"))
    oldImgName = value;
else if (name.equals("imgUploadStatus"))
    imgUploadStatus = value;
else if (name.equals("oldImgPath"))
    oldImgPath = value;
```

* ì„œë¸”ë¦¿ìœ¼ë¡œ ì˜¤ë©´ `Multipart` ê°ì²´ì—ì„œ ê¸°ì¡´ íŒŒì¼ê³¼ ê´€ë ¨ëœ ë¶€ë¶„ì´ ìˆìœ¼ë©´ ì €ì¥í•œë‹¤.
* ìˆ˜ì •ëª¨ë“œì—ì„œ ìƒˆë¡œìš´ íŒŒì¼ ì²¨ë¶€ë¥¼ í•˜ì§€ ì•Šê³  ì—¬ê¸°ë¡œ ì˜¤ê²Œ ë˜ë©´ ì—…ë¡œë“œ ëœ íŒŒì¼ì´ ì—†ìœ¼ë‹ˆ íŒŒì¼ ë“±ë¡ ê³¼ì •ì„ ê±°ì¹˜ì§€ ì•Šê³  ë‚´ë ¤ì˜¬ ê²ƒì´ë‹¤. `BoardDTO` ê°ì²´ì˜ ì´ë¯¸ì§€ íŒŒì¼ëª… ì •ë³´ëŠ” `null`ì¸ ìƒíƒœ<br><br>

```java
if (imgUploadStatus != null)
{
    if (imgUploadStatus.equals("false"))
    {
        // ë“±ë¡ëœ ì´ë¯¸ì§€ë¥¼ ì‚­ì œí•˜ëŠ” ê²½ìš°
        dto.setImage("ì—†ìŒ");
        File oldImg = new File(oldImgPath);
        if (oldImg.exists()) oldImg.delete();
    }
    else 
    {
        // ì‚­ì œí•˜ì§€ ì•ŠëŠ” ê²½ìš°
        if (dto.getImage() == null)
            dto.setImage(oldImgName);
    }
}
```

* ê¸°ì¡´ ì´ë¯¸ì§€ íŒŒì¼ ì •ë³´ê°€ ìˆì–´ì„œ ê·¸ê²ƒì„ ì–´ë–»ê²Œ ì²˜ë¦¬í•´ë¼ëŠ” ì§€ì‹œì‚¬í•­ì´ ìˆìœ¼ë©´ ê·¸ì— ë§ê²Œ ì²˜ë¦¬í•˜ëŠ” ë¶„ê¸°ë¡œ ì´ë™í•œë‹¤.
* ë“±ë¡ëœ ì´ë¯¸ì§€ë¥¼ ì‚­ì œí•˜ëŠ” ê²½ìš°ì—ëŠ” íŒŒì¼ëª…ì„ ì§€ìš°ê³  ì„œë²„ì—ì„œë„ í•´ë‹¹ íŒŒì¼ì„ ì§€ìš´ë‹¤.
* ì‚­ì œí•˜ì§€ ì•ŠëŠ” ê²½ìš°ì¸ë° ë§Œì•½ `BoardDTO`ì˜ íŒŒì¼ëª… í•„ë“œê°€ ë¹„ì–´ ìˆìœ¼ë©´ ê¸°ì¡´ íŒŒì¼ëª…ì„ ì €ì¥í•œë‹¤.
* ì´ì œ `BoardDTO`ë¥¼ `DB`ë¡œ ë³´ë‚´ ì—…ë°ì´íŠ¸ ë™ì‘ì„ ìˆ˜í–‰í•˜ë©´ íŒŒì¼ëª… í•„ë“œê°€ `null`ì´ ë˜ì§€ ì•Šê³  ì˜ ë‚¨ì•„ìˆê²Œ ëœë‹¤. 

* ì•„ë˜ëŠ” `FileUpload` í´ë˜ìŠ¤ì˜ ì „ì²´ ì½”ë“œì´ë‹¤.

```java
package com.project.cafe.board.action;

import java.io.File;

import javax.servlet.ServletContext;
import javax.servlet.http.HttpServletRequest;

import com.oreilly.servlet.multipart.DefaultFileRenamePolicy;
import com.oreilly.servlet.multipart.FilePart;
import com.oreilly.servlet.multipart.MultipartParser;
import com.oreilly.servlet.multipart.ParamPart;
import com.oreilly.servlet.multipart.Part;
import com.project.cafe.board.db.BoardDTO;

import net.coobird.thumbnailator.Thumbnails;
import net.coobird.thumbnailator.name.Rename;

public class FileUpload 
{
    public BoardDTO upload(HttpServletRequest request) throws Exception
    {
        System.out.println("upload() í˜¸ì¶œ ");
		
        BoardDTO dto = new BoardDTO();
		
        ServletContext ctx = request.getServletContext();
		
        // íŒŒì¼ì˜ ì €ì¥í¬ê¸°
        int maxSize = 10 * 1024 * 1024; // 10MB
		
        MultipartParser mp = new MultipartParser(request, maxSize);
        mp.setEncoding("utf-8");
        Part part;
		
        // ê¸°ì¡´ì— ì €ì¥ë˜ ìˆë˜ íŒŒì¼ ì •ë³´ë¥¼ ì €ì¥í•  ë³€ìˆ˜
        String imgUploadStatus = null;
        String oldImgPath = null;
        String oldImgName = null;
		
        String fileUploadStatus = null;
        String oldFilePath = null;
        String oldFileName = null;
		
        while ((part = mp.readNextPart()) != null)
        {
            // form íƒœê·¸ë¡œ ì €ì¥ëœ íŒŒë¼ë¯¸í„°ë¥¼ ì½ì–´ì˜´
            String name = part.getName();
			
            if (part.isParam())
            {
                // íŒŒì¼ì´ ì•„ë‹ ë•Œ
                ParamPart param = (ParamPart)part;
                String value = param.getStringValue();
				
                System.out.println("param name :" + name + " value : " + value);
				
                // ê° íŒŒë¼ë¯¸í„°ì— ë§ì¶° dtoì— ì €ì¥
                if (name.equals("id"))
                    dto.setId(value);
                else if (name.equals("title"))
                    dto.setTitle(value);
                else if (name.equals("content"))
                    dto.setContent(value);
                else if (name.equals("num"))
                    dto.setNum(Integer.parseInt(value));
                else if (name.equals("re_lev"))
                    dto.setRe_lev(Integer.parseInt(value));
                else if (name.equals("re_ref"))
                    dto.setRe_ref(Integer.parseInt(value));
                else if (name.equals("re_seq"))
                    dto.setRe_seq(Integer.parseInt(value));
                else if (name.equals("oldImgName"))
                    oldImgName = value;
                else if (name.equals("oldFileName"))
                    oldFileName = value;
                else if (name.equals("fileUploadStatus"))
                    fileUploadStatus = value;
                else if (name.equals("imgUploadStatus"))
                    imgUploadStatus = value;
                else if (name.equals("oldImgPath"))
                    oldImgPath = value;
                else if (name.equals("oldFilePath"))
                    oldFilePath = value;
            }
            else if (part.isFile() && name.equals("image"))
            {
                // ì´ë¯¸ì§€ íŒŒì¼ì¼ ë•Œ
                // ì´ë¯¸ì§€ ì €ì¥ ê²½ë¡œ ì§€ì •
                File dir = new File(ctx.getRealPath("/images"));
                File originDir = new File(dir + File.separator + "origins"); // ì›ë³¸ ì´ë¯¸ì§€ ì €ì¥ ê²½ë¡œ
                File thumbnailDir = new File(dir + File.separator + "thumbnails"); // ì¸ë„¤ì¼ ì €ì¥ ê²½ë¡œ
				
                // ê²½ë¡œê°€ ì—†ìœ¼ë©´ ìƒì„±
                if (!dir.isDirectory()) dir.mkdir();
                if (!originDir.isDirectory()) originDir.mkdir();
                if (!thumbnailDir.isDirectory()) thumbnailDir.mkdir();
				
                FilePart filePart = (FilePart) part;
                if (filePart.getFileName() != null)
                {
                    filePart.setRenamePolicy(new DefaultFileRenamePolicy());

                    // ì§€ì •í•œ ê²½ë¡œì— íŒŒì¼ ì“°ê¸°
                    String file = filePart.getFileName();
                    filePart.writeTo(originDir);
                    dto.setImage(file);
                    // ì¤‘ë³µ íŒŒì¼ëª…ì„ ì²˜ë¦¬í•  ë¶€ë¶„
                    dto.setImage_uid(filePart.getFileName());
					
                    // ì›ë³¸ ì´ë¯¸ì§€ íŒŒì¼ì„ ì´ìš©í•´ì„œ ì¸ë„¤ì¼ì„ ë§Œë“¤ì–´ ì €ì¥
                    // í¬ê¸° ì§€ì • í›„ ì§€ì • ê²½ë¡œì— ì €ì¥
                    Thumbnails.of(new File(originDir.getPath() + File.separator + file))
						.size(300, 400)
						.toFiles(thumbnailDir, Rename.NO_CHANGE);
                }
                else
                    System.out.println("img empty!");
            }
            else if (part.isFile() && name.equals("file"))
            {
                // ì¼ë°˜ íŒŒì¼ì¼ ë•Œ
                File dir = new File(ctx.getRealPath("/upload"));
				
                // ê²½ë¡œ ì—†ìœ¼ë©´ ìƒì„±
                if (!dir.isDirectory()) dir.mkdir();
				
                FilePart filePart = (FilePart) part;
                String file = filePart.getFileName();
                if (file != null)
                {
                    filePart.writeTo(dir); // ì§€ì •í•œ ê²½ë¡œì— íŒŒì¼ ì“°ê¸°
                    dto.setFile(file);
                    dto.setFile_uid(filePart.getFileName());
                }
                else
                    System.out.println("file empty!");
            }
        }
		
        // ì‚¬ìš©ì ipì£¼ì†Œ ì €ì¥
        dto.setIp(request.getRemoteAddr());
		
        if (imgUploadStatus != null)
        {
            if (imgUploadStatus.equals("false"))
            {
                // ë“±ë¡ëœ ì´ë¯¸ì§€ë¥¼ ì‚­ì œí•˜ëŠ” ê²½ìš°
                dto.setImage("ì—†ìŒ");
                File oldImg = new File(oldImgPath);
                if (oldImg.exists()) oldImg.delete();
            }
            else 
            {
                // ì‚­ì œí•˜ì§€ ì•ŠëŠ” ê²½ìš°
                // ë§Œì•½ dtoì˜ íŒŒì¼ëª… í•„ë“œê°€ ë¹„ì–´ ìˆìœ¼ë©´ ê¸°ì¡´ íŒŒì¼ëª…ì„ ì €ì¥í•œë‹¤.
                if (dto.getImage() == null)
                    dto.setImage(oldImgName);
            }
        }
		
        if (fileUploadStatus != null)
        {
            if (fileUploadStatus.equals("false"))
            {
                dto.setFile("ì—†ìŒ");
                File oldFile = new File(oldFilePath);
                if (oldFile.exists()) oldFile.delete();
            }
            else 
            {
                if (dto.getFile() == null)
                    dto.setFile(oldFileName);
            }
        }
		
        return dto;
    }
}
```

* í•´ê²°~!!
