---
title: JSP) DAO
toc: true
toc_sticky: true
toc_label: ëª©ì°¨
published: true
categories:
    - JSP
tags:
    - Database
    - JSP
    - DAO
---
# ğŸ‘€ DAO(Data Access Object)ë€?
* ë°ì´í„° ì²˜ë¦¬ ê°ì²´
* `DB`ì— ê´€ë ¨ëœ ëª¨ë“  ë™ì‘ì„ ìˆ˜í–‰í•˜ëŠ” í´ë˜ìŠ¤
* ì§€ê¸ˆê¹Œì§€ `JDBC`ë¡œ `DB`ì™€ ì—°ê²°í•  ë•Œ ì‚¬ìš©í•˜ë ¤ëŠ” í˜ì´ì§€ë§ˆë‹¤ ì¼ì¼ì´ ì—°ê²° ì½”ë“œë¥¼ ì ì–´ì¤˜ì•¼ í–ˆëŠ”ë° ì´ì œëŠ” `DAO`ë¥¼ ë§Œë“¤ì–´ì„œ ì—°ê²° ë™ì‘ì„ ì—¬ê¸°ì„œ ìˆ˜í–‰í•˜ë„ë¡ í•˜ê³  `DB`ì—°ê²°ì´ í•„ìš”í•œ í˜ì´ì§€ì—ì„œëŠ” `DAO`ë§Œ í˜¸ì¶œí•˜ë©´ ëœë‹¤!

```java
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;

public class MemberDAO { 
	
	// DAO (Data Access Object) : ë°ì´í„° ì²˜ë¦¬ ê°ì²´
	// => DBì— ê´€ë ¨ëœ ëª¨ë“  ë™ì‘ì„ ìˆ˜í–‰í•˜ëŠ” í´ë˜ìŠ¤
	
	// ì—°ê²°ì— í•„ìš”í•œ ì •ë³´ ì €ì¥
	private Connection con = null;
	private PreparedStatement pstmt = null;
	private ResultSet rs = null;
	private String sql = "";
	
	// ë””ë¹„ì—°ê²° ë™ì‘
	private Connection getConnect()
	{
	    final String DRIVER = "com.mysql.cj.jdbc.Driver";
	    final String URL = "jdbc:mysql://localhost:3306/jspdb";
	    final String ID = "root";
	    final String PASS = "1234";
	    
	    try // ì˜ˆì™¸ê°€ ë°œìƒí• ì§€ë„ ëª¨ë¥´ëŠ” ì½”ë“œ ì‘ì„± 
	    { 
			// 1. ë“œë¼ì´ë²„ ë¡œë“œ
			Class.forName(DRIVER);

			// 2. ë””ë¹„ì—°ê²°
			con = DriverManager.getConnection(URL, ID, PASS);
			
			System.out.println("DAO : ë””ë¹„ì—°ê²° ì„±ê³µ!" + con);
		} 
	    catch (ClassNotFoundException e) 
	    {
			e.printStackTrace();
		} 
	    catch (SQLException e) 
	    {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} // ì—°ê²° ì •ë³´ê°€ ê³„ì† ìœ ì§€ë˜ì–´ì•¼ í•˜ê¸° ë•Œë¬¸ì— finally êµ¬ë¬¸ì€ ì•ˆì“´ë‹¤.
	    
		
		return con;
	} // ë””ë¹„ì—°ê²°
	
	// ìì›í•´ì œ
	public void CloseDB()
	{
		try {
			
			// ë¦¬ì†ŒìŠ¤ í•´ì œëŠ” ìƒì„±ì˜ ì—­ìˆœìœ¼ë¡œ í•œë‹¤.
			if (null != rs) rs.close(); // ì—°ê²°í•´ì œ
			if (null != pstmt) pstmt.close();
			if (null != con) con.close(); 
			System.out.println("DAO : ìì›í•´ì œ ì™„ë£Œ");
			
		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} 
	} // ìì›í•´ì œ
	
	// íšŒì›ê°€ì… - insertMember()
	public void insertMember(MemberBean mb)
	{
		System.out.println("DAO : insertMember() í˜¸ì¶œ");
		try {
			// 1. ë“œë¼ì´ë²„ ë¡œë“œ
			// 2. ë””ë¹„ì—°ê²°
			con = getConnect();
			
			// 3. sql ì‘ì„± & pstmt ê°ì²´ ìƒì„±
			sql = "insert into itwill_member(id, pass, name, age, gender, email, regdate) "
					+ "values(?, ?, ?, ?, ?, ?, ?)";
			pstmt = con.prepareStatement(sql);
			
			// ???
			pstmt.setString(1, mb.getId());
			pstmt.setString(2, mb.getPass());
			pstmt.setString(3, mb.getName());
			pstmt.setInt(4, mb.getAge());
			pstmt.setString(5, mb.getGender());
			pstmt.setString(6, mb.getEmail());
			pstmt.setTimestamp(7, mb.getRegdate());
			
			// 4. sql ì‹¤í–‰
			int result = pstmt.executeUpdate();
			System.out.println("DAO : íšŒì›ê°€ì… ì„±ê³µ!" + result);
			
		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		finally {
			
			CloseDB();
		}
	} // íšŒì›ê°€ì… - insertMember()
	
	// ë¡œê·¸ì¸ - loginCheck(mb)
	public int loginCheck(MemberBean mb)
	{
		System.out.println("DAO : ë¡œê·¸ì¸ - loginCheck(mb)");
		
		int result = -1;
		try {
			// 1, 2. ë””ë¹„ì—°ê²°
			con = getConnect();
			
			// 3. sql ì‘ì„±(select) & pstmt ê°ì²´ ìƒì„±
			sql = "select pass from itwill_member where id=?";
			pstmt = con.prepareStatement(sql);
			
			// ??
			pstmt.setString(1, mb.getId());
			
			// 4. sql ì‹¤í–‰
			rs = pstmt.executeQuery();
			
			// 5. ë°ì´í„°ì²˜ë¦¬
			if (rs.next())
			{
				// íšŒì›
				if (mb.getPass().equals(rs.getString("pass")))
				{
					// ë³¸ì¸
					result = 1;
				}
				else 
				{
					// ë¹„ë°€ë²ˆí˜¸ ì˜¤ë¥˜
					result = 0;
				}
			}
			else 
			{
				// ë¹„íšŒì›
				result = -1;
			}
			
			System.out.println("DAO : ë¡œê·¸ì¸ì²´í¬ ì™„ë£Œ (" + result + ")");
			
		} catch (SQLException e) {

			e.printStackTrace();
		} finally {
			
			CloseDB();
		}

		System.out.println("DAO : ë¡œê·¸ì¸ - loginCheck(mb)");
		return result;
	} // ë¡œê·¸ì¸ - loginCheck(mb)

} // MemberDAO
```

* ì´ë ‡ê²Œ `DAO` í´ë˜ìŠ¤ë¥¼ ë§Œë“  ë‹¤ìŒì—<br><br>

```jsp
<body>
  <%
    // í•œê¸€ì²˜ë¦¬
    request.setCharacterEncoding("UTF-8");
    
    // ì „ë‹¬ë˜ëŠ” ì •ë³´ ì €ì¥ - ì•¡ì…˜íƒœê·¸
  %>
    <jsp:useBean id="mb" class="com.itwillbs.member.MemberBean"></jsp:useBean>
    <jsp:setProperty property="*" name="mb"/>
  <%
    // DBì •ë³´ë¥¼ ì‚¬ìš©í•´ì„œ ë¡œê·¸ì¸ ì²´í¬
    // DAO ê°ì²´ ìƒì„±
    MemberDAO dao = new MemberDAO();
    int result = dao.loginCheck(mb);
    System.out.println("pro : ë¡œê·¸ì¸ì²´í¬ ì™„ë£Œ (" + result + ")");
    
    if (1 == result)
    {
    	session.setAttribute("id", mb.getId());
    	%>
    	  <script type="text/javascript">
    	    alert("ë¡œê·¸ì¸ ì„±ê³µ!")
    	    location.href='main.jsp';
    	  </script>
    	<%
    }
    else if (0 == result)
    {
    	%>
    	  <script type="text/javascript">
    	    alert("ë¹„ë°€ë²ˆí˜¸ ì˜¤ë¥˜!");
    	    history.back();
    	  </script>
    	<%
    }
    else
    {
    	%>
    	  <script type="text/javascript">
    	    alert("ë¹„íšŒì› ì…ë‹ˆë‹¤!");
    	    history.back();
    	  </script>
    	<%
    }
    
    // ì²´í¬ ê²°ê³¼ì— ë”°ë¥¸ í˜ì´ì§€ ì´ë™
  %>
</body>
```

* `JSP` í˜ì´ì§€ì—ì„œëŠ” ì•„ê¹Œ ë§Œë“  ê°ì²´ë¥¼ í˜¸ì¶œí•˜ê¸°ë§Œ í•˜ë©´ ëœë‹¤!
